<link rel="import" href="../bower_components/app-layout/app-drawer/app-drawer.html">
<link rel="import" href="../bower_components/app-layout/app-drawer-layout/app-drawer-layout.html">
<link rel="import" href="../bower_components/app-layout/app-header/app-header.html">
<link rel="import" href="../bower_components/app-layout/app-header-layout/app-header-layout.html">
<link rel="import" href="../bower_components/app-layout/app-toolbar/app-toolbar.html">
<link rel="import" href="../bower_components/app-localize-behavior/app-localize-behavior.html">
<link rel="import" href="../bower_components/app-route/app-location.html">
<link rel="import" href="../bower_components/app-route/app-route.html">
<link rel="import" href="../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../bower_components/iron-selector/iron-selector.html">
<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/polymer/lib/elements/dom-if.html">
<link rel="import" href="../bower_components/shadycss/apply-shim.html">

<link rel="import" href="styles/base.html">
<link rel="import" href="polymer-custom.html">

<link rel="lazy-import" href="settings/settings-view.html">
<link rel="lazy-import" href="init/init-view.html">
<link rel="lazy-import" href="login/login-view.html">

<dom-module id="principal-view">
    <template>

      <style include="base">
        
        :host {
        }

        app-drawer div{
          height: 3rem;
          width: 100%;
        }

        .menu1
        {
          width: 3rem;
          height: 30rem;
        }

        app-drawer-layout:not([narrow]) [drawer-toggle] {
          display: none;
        }

        iron-selector>a{
          background-color: lightcyan;
          border-radius: 5%;
          box-shadow: 0 0 3px 0 black; 
          color: gray;
          cursor: pointer; 
          display: block; 
          height: 25px;
          margin: 2rem 0 0 2.5rem; 
          padding: 15px;
          text-decoration: none;
          width: 9.6rem;      
        }

        iron-selector>a:first-child{
          margin-top:-4rem;
        }

        iron-selector>a:hover{
          opacity: .7;
          background-color:  #6b1888;
          text-decoration:none;
          color:white;
        }

        .img-logo{
          width: 100px;
          height: 70px;
          top: 10px;
          position: absolute;
          left: 60px;
        }

        .main-menu{
            top: 250px;
            position: absolute;
            left: 14px;
        }
        .titulo{
          background-color: seashell;
          border: 2px solid gray;

        }

        .img-init{
          width: 85%;
          margin: 0 7.5%;
        }

        #contentContainer{          
        }

        .menu-title{
          width: 3rem;
          height: 2rem;
        }

      </style>

      <app-location route="{{route}}"></app-location>
      <app-route route="{{route}}" pattern="/:view" data="{{routeData}}" tail="{{routeTail}}"></app-route>

      <app-drawer-layout class="styleCustom" fullbleed narrow="{{narrow}}">

        <app-drawer slot="drawer" swipe-open="[[narrow]]">
          <app-toolbar main-title class="menu-title"><div>Menu</div></app-toolbar>
          <div> 
            <iron-selector class="main-menu" selected="[[view]]" attr-for-selected="view" role="navigation">
              <a view="login-view" href="/login-view"><iron-icon icon="icons:account-box"></iron-icon> Login</a></a>
             <template is="dom-if" if="[[mostrarBotones]]">
                <a view="init-view" href="/init-view"><iron-icon icon="icons:home" ></iron-icon> [[localize('initViewMenuItem')]]</a></a>
                <a view="settings-view" href="/settings-view"><iron-icon icon="icons:settings"></iron-icon> [[localize('settingViewMenuItem')]]</a>
              </template>
            </iron-selector>
          </div>
        </app-drawer>

        <app-header-layour>
          <app-header slot="header" waterfall>
            <app-toolbar main-title class="titulo"><div>[[localize('mainTitle')]]</div></app-toolbar>       
          </app-header>
          <div class="menu">
          <iron-pages selected="[[routeData.view]]" attr-for-selected="view" role="main" fallback-selection="not-selection">
            <login-view view="login-view"></login-view>          
            <init-view view="init-view" tail="{{routeTail}}"></init-view>
            <settings-view view="settings-view"></settings-view>
            <div view="not-selection">
              <img class="img-init" src="images/play-home.png" alt="">
            </div>
          </iron-pages>
          </div>
        </app-header-layour>
      </app-drawer-layout>

    </template>

    <script>
      (function principalViewDefinition(principalView) {
          'use strict';

          class PrincipalView extends PolymerCustom(Polymer.Element)  {

              static get is(){ return `principal-view`;}

              static get properties(){
                  return{
                    routeData:{
                      type:Object,
                      value:{view:'init-view'},
                      notify:true
                    },
                    user:{
                      type:Object,
                      statePath:`user`,
                      observer:`_foo`
                    },
                    mostrarBotones:{
                      type:Boolean,
                      computed:`_cambioUsuario(user)` 
                    }
                  }
              }

              _cambioUsuario(user){
                 console.log(`_cambioUsuario ${user}`);
                  return user != null;
              }

              static get observers(){
                return ['_routeChanged(routeData.view)'];
              }

              _routeChanged(view){
                  let viewToLoad = !view||view==``?`init-view`:view;

                  if(viewToLoad == `init-view`)
                    viewToLoad = `init/${viewToLoad}`;
                    else
                      if(viewToLoad == `settings-view`)
                        viewToLoad = `settings/${viewToLoad}`;
                      else
                        if(viewToLoad == `login-view`)
                          viewToLoad = `login/${viewToLoad}`;

                  var resolverdPageUrl=this.resolveUrl(`${viewToLoad}.html`);

                  Polymer.importHref(
                    resolverdPageUrl,
                    null,
                    this._showPage404.bind(this),
                    true
                  );
              }

              _showPage404(){
                this.page=`init-view`;
              }

              _foo(user){
                console.log(`_foo ${user}`);
              }
 
          }

          customElements.define(PrincipalView.is, PrincipalView);

      })(window.principalView);

    </script>
</dom-module>
